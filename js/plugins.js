(()=>{var b=(e,t,r)=>new Promise((n,o)=>{var l=c=>{try{u(r.next(c))}catch(i){o(i)}},a=c=>{try{u(r.throw(c))}catch(i){o(i)}},u=c=>c.done?n(c.value):Promise.resolve(c.value).then(l,a);u((r=r.apply(e,t)).next())});var R="https://raw.githubusercontent.com/";function x(e,t,r){return R+e+"/"+(r||"HEAD")+"/"+t}function v(){return b(this,null,function*(){let e=yield ajaxPromise({url:x("eighred/Eighred-releases","community-plugins.json")}),t=JSON.parse(e);if(!Array.isArray(t))throw new Error("Failed to parse community plugins.");return t})}function T(){return b(this,null,function*(){let e=yield ajaxPromise({url:x("eighred/Eighred-releases","community-plugin-stats.json")});try{return JSON.parse(e)}catch(t){throw t}})}function I(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function y(e,t,r){return r||(r=t+"s"),e===1?e+" "+t:I(e)+" "+r}var m="";try{let e=new URLSearchParams(location.search);m=e.get("id"),m?setTimeout(()=>{location.href="Eighred://show-plugin?id="+encodeURIComponent(m)},0):m=e.get("search")}catch(e){console.error(e)}m=m||"";b(void 0,null,function*(){let e=i=>{let h=i.length,p;for(;h!==0;)p=Math.floor(Math.random()*h),h--,[i[h],i[p]]=[i[p],i[h]];return i},t=fish(".plugins-container"),r=fish(".plugin-count"),n=fish(".plugin-search"),o=yield v(),l=yield T();r.setText(y(o.length,"plugin")),e(o);function a(i){i=(i||"").trim();let h=i.toLowerCase().split(" ");t.empty();let p=[];for(let s of o){let d=-1/0,g,f,w;if(i){if(g=S(h,i,s.name),f=S(h,i,s.description),w=S(h,i,s.author),!g&&!f&&!w&&i!==s.id.toLowerCase())continue;g&&(d=Math.max(g.score,d)),f&&(d=Math.max(f.score,d)),w&&(d=Math.max(w.score,d))}let P=l.hasOwnProperty(s.id)?l[s.id].downloads:0,C=jsx("div",{class:"p-5 flex flex-col rounded-lg bg-secondary transition-all hover:shadow-2xl hover:bg-gray-800"},jsx("div",{class:"text-lg mb-1 font-semibold leading-tight"},M(s.name,g?g.matches:null)),jsx("p",{class:"text-muted text-sm"},"By\xA0",M(s.author,w?w.matches:null)),P?jsx("p",{class:"text-muted text-sm"}," ",y(P,"download")):"",jsx("div",{class:"py-3 leading-tight"},M(s.description,f?f.matches:null)),jsx("div",{class:"text-center mt-auto"},jsx("div",{class:"flex-1 flex gap-4 mt-3"},jsx("a",{class:"block button py-1.5 text-sm shadow",href:"#",onclick:()=>location.href="Eighred://show-plugin?id="+encodeURIComponent(s.id)},"Install"),jsx("a",{class:"ml-auto block text-muted font-medium py-1.5 text-sm",href:`https://github.com/${s.repo}`,target:"_blank"},"Learn\xA0more"),jsx("a",{class:"flex text-muted font-medium py-1.5 text-sm",href:"#",onclick:()=>navigator.clipboard.writeText("https://eighred.com/plugins?id="+encodeURIComponent(s.id))},"Copy\xA0link"))));p.push({score:d,el:C})}p.sort((s,d)=>d.score-s.score);for(let s of p)t.appendChild(s.el)}n.value=m,a(m);let u=()=>{let i=n.value;a(i),i!==""?window.history.replaceState(null,null,`?search=${i}`):window.history.replaceState(null,null,window.location.pathname)},c=0;n.addEventListener("input",()=>{window.clearTimeout(c),c=window.setTimeout(u,100)})});function S(e,t,r){let n=L(e,r);return n?{score:E(n,t.length,r.length,0),matches:n}:null}function E(e,t,r,n){if(e.length===0)return 0;let o=0;o-=Math.max(0,e.length-1),o-=n/10;let l=e[0][0],a=e[e.length-1][1];return o-=(a-l+1-t)/100,o-=l/1e3,o-=r/1e4,o}function L(e,t){let r=t.toLowerCase(),n=[];for(let o of e){if(!o)continue;let l=!1,a=-1,u=o.length;for(;(a=r.indexOf(o,a))!==-1;)l=!0,n.push([a,a+u]),a+=u+1;if(!l)return null}return j(n)}var U=(e,t)=>e[0]-t[0];function j(e){if(e.length===0)return e;e.sort(U);let t=[e[0]];for(let r=1;r<e.length;r++){let n=t.last();n[1]<e[r][0]?t.push(e[r]):n[1]<e[r][1]&&(n[1]=e[r][1])}return t}function M(e,t){if(!t||t.length===0)return document.createTextNode(e);let r=document.createDocumentFragment(),n=0;for(let o=0;n<e.length&&o<t.length;o++){let l=t[o],a=l[0],u=l[1];if(!(u<=0)){if(a>=e.length)break;a<0&&(a=0),a!==n&&r.appendText(e.substring(n,a)),r.createSpan({cls:"suggestion-highlight",text:e.substring(a,u)}),n=u}}return n<e.length&&r.appendText(e.substring(n)),r}})();
